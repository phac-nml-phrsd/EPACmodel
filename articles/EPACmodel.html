<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Introduction to EPACmodel • EPACmodel</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Introduction to EPACmodel">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">EPACmodel</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Released version">1.3.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="active nav-item"><a class="nav-link" href="../articles/EPACmodel.html">Get started</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/pkg-models.html">Package models</a></li>
    <li><a class="dropdown-item" href="../articles/local-models.html">Locally-defined models</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/phac-nml-phrsd/EPACmodel/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Introduction to EPACmodel</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/phac-nml-phrsd/EPACmodel/blob/main/vignettes/EPACmodel.Rmd" class="external-link"><code>vignettes/EPACmodel.Rmd</code></a></small>
      <div class="d-none name"><code>EPACmodel.Rmd</code></div>
    </div>

    
    
<p>The goal of this package is to catalogue, document, and version
iterations of the Early Pandemic Age-structured Compartmental model so
that they can be pulled easily into project-specific pipelines to
produce modelling outputs.</p>
<div class="section level2">
<h2 id="set-up-model-simulator">Set up model simulator<a class="anchor" aria-label="anchor" href="#set-up-model-simulator"></a>
</h2>
<p>To work with a model, we need to set up its simulator. A simulator in
<code>macpan2</code> is an object that includes model structure (state
names, flow expressions, etc.) along with a set of variable values (such
as components of flow rates, initial states) that ensure it is ready to
produce simulation results.</p>
<p>This package includes several models whose simulators can quickly and
easily be retrieved (see <code><a href="../articles/pkg-models.html">vignette("pkg-models")</a></code>). It can
also work with locally defined models (see
<code><a href="../articles/local-models.html">vignette("local-models")</a></code>).</p>
<p>Package model names can be listed with:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/list_models.html">list_models</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "five-year-age-groups" "hosp"                 "old-and-young"</span></span></code></pre></div>
<p>To get a model’s simulator, we simply call:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">model.name</span> <span class="op">&lt;-</span> <span class="st">"old-and-young"</span></span>
<span><span class="va">model_simulator</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/make_simulator.html">make_simulator</a></span><span class="op">(</span></span>
<span>  model.name <span class="op">=</span> <span class="va">model.name</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>By default, <code><a href="../reference/make_simulator.html">make_simulator()</a></code> will attach a set of
default values for variables in the model (components of flow rates,
initial states, etc.) to the model structure. It will also set a default
number of time steps. You can see all default values easily as
follows:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># load default values (initial state, params, etc.)</span></span>
<span><span class="va">default.values</span> <span class="op">=</span> <span class="fu"><a href="../reference/get_default_values.html">get_default_values</a></span><span class="op">(</span><span class="va">model.name</span><span class="op">)</span></span></code></pre></div>
<p>The definition of each default value is documented in
<code><a href="../articles/pkg-models.html">vignette("pkg-models")</a></code>.</p>
<p>Any of these values can be changed by passing the optional
<code>values</code> argument to <code><a href="../reference/make_simulator.html">make_simulator()</a></code>. We
recommend first loading the entire list of default values and extracting
the specific value (list element) that you want to update, editing the
numeric quantity as desired, and then passing the modified list element
to <code><a href="../reference/make_simulator.html">make_simulator()</a></code> via the <code>values</code> argument,
to ensure that format of value is preserved to remain compatible with
the model definition and <code>macpan2</code>:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># get default initial state</span></span>
<span><span class="va">default.state</span> <span class="op">=</span> <span class="va">default.values</span><span class="op">$</span><span class="va">state</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="st">"default state:"</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "default state:"</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">default.state</span><span class="op">)</span></span>
<span><span class="co">#&gt;      S_y      R_y      E_y      I_y      H_y      D_y      S_o      R_o </span></span>
<span><span class="co">#&gt; 31400000        0        1        1        0        0  6900000        0 </span></span>
<span><span class="co">#&gt;      E_o      I_o      H_o      D_o </span></span>
<span><span class="co">#&gt;        1        1        0        0</span></span>
<span></span>
<span><span class="co"># move some young susceptibles to the recovered class</span></span>
<span><span class="va">new.state</span> <span class="op">=</span> <span class="va">default.state</span> <span class="co"># copy over default value to preserve format</span></span>
<span><span class="va">new.state</span><span class="op">[</span><span class="st">"R_y"</span><span class="op">]</span> <span class="op">=</span> <span class="fl">1000</span> <span class="co"># modify specific elements</span></span>
<span><span class="va">new.state</span><span class="op">[</span><span class="st">"S_y"</span><span class="op">]</span> <span class="op">=</span> <span class="va">new.state</span><span class="op">[</span><span class="st">"S_y"</span><span class="op">]</span> <span class="op">-</span> <span class="va">new.state</span><span class="op">[</span><span class="st">"R_y"</span><span class="op">]</span> <span class="co"># modify specific elements</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="st">"new state:"</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "new state:"</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">new.state</span><span class="op">)</span></span>
<span><span class="co">#&gt;      S_y      R_y      E_y      I_y      H_y      D_y      S_o      R_o </span></span>
<span><span class="co">#&gt; 31399000     1000        1        1        0        0  6900000        0 </span></span>
<span><span class="co">#&gt;      E_o      I_o      H_o      D_o </span></span>
<span><span class="co">#&gt;        1        1        0        0</span></span>
<span></span>
<span><span class="co"># use updated state to make a new simulator </span></span>
<span><span class="va">new_model_simulator</span> <span class="op">=</span> <span class="fu"><a href="../reference/make_simulator.html">make_simulator</a></span><span class="op">(</span></span>
<span>  model.name <span class="op">=</span> <span class="va">model.name</span>,</span>
<span>  values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>state <span class="op">=</span> <span class="va">new.state</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>(This approach works well if you want to update a parameter just
once. However, if you want to repeatedly update some (or all) model
parameters and re-run the simulator each time, this method would be
costly as initializing a simulator takes a few seconds. Below, we
discuss updating parameters after a model simulator is built, which is
relatively fast.)</p>
</div>
<div class="section level2">
<h2 id="simulate-a-model">Simulate a model<a class="anchor" aria-label="anchor" href="#simulate-a-model"></a>
</h2>
<p>To simulate a model, just use the <code><a href="../reference/simulate.html">simulate()</a></code>
function:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sim.output</span> <span class="op">=</span> <span class="fu"><a href="../reference/simulate.html">simulate</a></span><span class="op">(</span><span class="va">model_simulator</span><span class="op">)</span></span></code></pre></div>
<p>Since the model simulator already has all required values attached,
all required calculations can be performed to produce the simulation
results.</p>
<p>For all models, simulation outputs are stored in a data frame with
columns</p>
<pre><code><span><span class="va">time</span> <span class="op">|</span> <span class="va">state_name</span> <span class="op">|</span> <span class="va">value_type</span> <span class="op">|</span> <span class="va">value</span></span></code></pre>
<p>The output <code>value_types</code> are</p>
<ul>
<li>
<code>state</code>: the number of individuals in given state at a
given time,</li>
<li>
<code>total_inflow</code>: the total inflow into a given compartment
at a given time.</li>
</ul>
<p>For instance, here is the number of individuals in each state,
stratified by the two age groups <code>y</code> (young) and
<code>o</code> (old), at time 10:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="op">(</span><span class="va">sim.output</span></span>
<span> <span class="op">|&gt;</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">value_type</span> <span class="op">==</span> <span class="st">'state'</span>, <span class="va">time</span> <span class="op">==</span> <span class="fl">10</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt;    time state_name value_type        value</span></span>
<span><span class="co">#&gt; 1    10        S_y      state 3.139988e+07</span></span>
<span><span class="co">#&gt; 2    10        E_y      state 7.888172e+01</span></span>
<span><span class="co">#&gt; 3    10        I_y      state 2.644023e+01</span></span>
<span><span class="co">#&gt; 4    10        H_y      state 5.068467e+00</span></span>
<span><span class="co">#&gt; 5    10        R_y      state 7.329988e+00</span></span>
<span><span class="co">#&gt; 6    10        D_y      state 7.329988e-01</span></span>
<span><span class="co">#&gt; 7    10        S_o      state 6.899959e+06</span></span>
<span><span class="co">#&gt; 8    10        E_o      state 2.621033e+01</span></span>
<span><span class="co">#&gt; 9    10        I_o      state 9.945527e+00</span></span>
<span><span class="co">#&gt; 10   10        H_o      state 2.328352e+00</span></span>
<span><span class="co">#&gt; 11   10        R_o      state 3.674943e+00</span></span>
<span><span class="co">#&gt; 12   10        D_o      state 3.674943e-01</span></span></code></pre></div>
<p>The total inflow into
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>I</mi><annotation encoding="application/x-tex">I</annotation></semantics></math>
compartments can be used to extract disease incidence by age over
time:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="op">(</span><span class="va">sim.output</span></span>
<span> <span class="op">|&gt;</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span></span>
<span>   <span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_detect.html" class="external-link">str_detect</a></span><span class="op">(</span><span class="va">state_name</span>, <span class="st">"^I"</span><span class="op">)</span>,</span>
<span>   <span class="va">value_type</span> <span class="op">==</span> <span class="st">'total_inflow'</span></span>
<span> <span class="op">)</span></span>
<span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt;   time state_name   value_type     value</span></span>
<span><span class="co">#&gt; 1    1        I_y total_inflow 0.1000000</span></span>
<span><span class="co">#&gt; 2    1        I_o total_inflow 0.1000000</span></span>
<span><span class="co">#&gt; 3    2        I_y total_inflow 0.0990000</span></span>
<span><span class="co">#&gt; 4    2        I_o total_inflow 0.0990000</span></span>
<span><span class="co">#&gt; 5    3        I_y total_inflow 0.1455143</span></span>
<span><span class="co">#&gt; 6    3        I_o total_inflow 0.1195285</span></span></code></pre></div>
<p>We can plot the results using standard data manipulation and plotting
tools, like <code>dplyr</code> and <code>ggplot2</code>:</p>
<p><img src="EPACmodel_files/figure-html/sim-output-1-1.png" width="700"></p>
<p>We could also update model parameters before the simulation using the
<code>values</code> argument.<a class="footnote-ref" tabindex="0" data-bs-toggle="popover" data-bs-content="&lt;p&gt;Currently only supported for the &lt;code&gt;hosp&lt;/code&gt;
model.&lt;/p&gt;"><sup>1</sup></a> Here, it’s important to pass the
<strong>complete</strong> list of model values (with any desired
updates).<a class="footnote-ref" tabindex="0" data-bs-toggle="popover" data-bs-content='&lt;p&gt;As opposed to with &lt;code&gt;&lt;a href="../reference/make_simulator.html"&gt;make_simulator()&lt;/a&gt;&lt;/code&gt; where
we could pass only a partial parameter list and use defaults for the
remaining parameters. This requirement could be relaxed in future
versions.&lt;/p&gt;'><sup>2</sup></a> As a result, we suggest starting by loading
a complete list of the model’s values with
<code><a href="../reference/get_default_values.html">get_default_values()</a></code>, updating the desired values, and then
passing this list to <code><a href="../reference/simulate.html">simulate()</a></code> as below. Note that the
<code>time.steps</code> parameter cannot be updated after the model
simulator is built and must instead be modified using the
<code>values</code> argument of <code><a href="../reference/make_simulator.html">make_simulator()</a></code>.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">model.name2</span> <span class="op">&lt;-</span> <span class="st">"hosp"</span></span>
<span><span class="va">model_simulator2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/make_simulator.html">make_simulator</a></span><span class="op">(</span><span class="va">model.name2</span>, values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>time.steps <span class="op">=</span> <span class="fl">365</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="EPACmodel_files/figure-html/unnamed-chunk-10-1.png" width="700"></p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">values2</span> <span class="op">=</span> <span class="fu"><a href="../reference/get_default_values.html">get_default_values</a></span><span class="op">(</span><span class="va">model.name2</span><span class="op">)</span></span>
<span><span class="va">values2</span><span class="op">$</span><span class="va">transmissibility</span> <span class="op">&lt;-</span> <span class="va">values2</span><span class="op">$</span><span class="va">transmissibility</span><span class="op">*</span><span class="op">(</span><span class="fl">1</span><span class="op">-</span><span class="fl">0.2</span><span class="op">)</span> <span class="co"># reduce transmissibility by 20%</span></span></code></pre></div>
<pre><code><span><span class="co">#&gt; Updating simulator values in `simulate` only supported for the `hosp` model currently.</span></span></code></pre>
<p><img src="EPACmodel_files/figure-html/unnamed-chunk-12-1.png" width="700"></p>
</div>
<div class="section level2">
<h2 id="scenarios">Scenarios<a class="anchor" aria-label="anchor" href="#scenarios"></a>
</h2>
<p>By default, <code><a href="../reference/make_simulator.html">make_simulator()</a></code> will initialize a base
model. Some model definitions include optional scenarios on top of the
base model, such as interventions modelled through time-varying model
parameters. For instance, one could simulate a stay-at-home order by
reducing the transmission rate on a given date by some amount.</p>
<p>One can specify the <code>scenario.name</code> argument in
<code><a href="../reference/make_simulator.html">make_simulator()</a></code> to attach the required model structure to
simulate a given scenario type. Scenario options and descriptions are
catalogued in <code><a href="../articles/pkg-models.html">vignette("pkg-models")</a></code>.</p>
<p>Here we demonstrate the <code>old-and-young</code> model with the
<code>transmission-intervention</code> scenario. By default, this
scenario reduces the transmission rate in each age group to 50% then 10%
of its original value on days 30 and 40, respectively:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">values</span> <span class="op">=</span> <span class="fu"><a href="../reference/get_default_values.html">get_default_values</a></span><span class="op">(</span><span class="st">"old-and-young"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">values</span><span class="op">[</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"intervention.day"</span>, <span class="st">"trans.factor.young"</span>, <span class="st">"trans.factor.old"</span><span class="op">)</span></span>
<span><span class="op">]</span></span>
<span><span class="co">#&gt; $intervention.day</span></span>
<span><span class="co">#&gt; [1] 40 50</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $trans.factor.young</span></span>
<span><span class="co">#&gt; [1] 0.5 0.1</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $trans.factor.old</span></span>
<span><span class="co">#&gt; [1] 0.5 0.1</span></span></code></pre></div>
<p>We specify that we want to use the <code>change-transmission</code>
scenario in the call to <code><a href="../reference/make_simulator.html">make_simulator()</a></code>:</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">model_simulator</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/make_simulator.html">make_simulator</a></span><span class="op">(</span></span>
<span>  model.name <span class="op">=</span> <span class="st">"old-and-young"</span>,</span>
<span>  scenario.name <span class="op">=</span> <span class="st">"change-transmission"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">sim.output</span> <span class="op">=</span> <span class="fu"><a href="../reference/simulate.html">simulate</a></span><span class="op">(</span><span class="va">model_simulator</span><span class="op">)</span></span></code></pre></div>
<p><img src="EPACmodel_files/figure-html/sim-output-2-1.png" width="700"></p>
</div>

  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by <a href="https://github.com/papsti" class="external-link">Irena Papst</a>, <a href="https://github.com/wzmli" class="external-link">Michael WZ Li</a>.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
