<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="EPACmodel">
<title>Introduction to EPACmodel • EPACmodel</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Introduction to EPACmodel">
<meta property="og:description" content="EPACmodel">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">EPACmodel</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Released version">1.1.0</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="active nav-item">
  <a class="nav-link" href="../articles/EPACmodel.html">Get started</a>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/pkg-models.html">Package models</a>
    <a class="dropdown-item" href="../articles/local-models.html">Locally-defined models</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/phac-nml-phrsd/EPACmodel/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Introduction to EPACmodel</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/phac-nml-phrsd/EPACmodel/blob/HEAD/vignettes/EPACmodel.Rmd" class="external-link"><code>vignettes/EPACmodel.Rmd</code></a></small>
      <div class="d-none name"><code>EPACmodel.Rmd</code></div>
    </div>

    
    
<p>The goal of this package is to catalogue, document, and version
iterations of the Early Pandemic Age-structured Compartmental model so
that they can be pulled easily into project-specific pipelines to
produce modelling outputs.</p>
<div class="section level2">
<h2 id="set-up-model-simulator">Set up model simulator<a class="anchor" aria-label="anchor" href="#set-up-model-simulator"></a>
</h2>
<p>To work with a model, we need to set up its simulator. A simulator in
<code>macpan2</code> is an object that includes model structure (state
names, flow expressions, etc.) along with a set of variable values (such
as components of flow rates, initial states) that ensure it is ready to
produce simulation results.</p>
<p>This package includes several models whose simulators can quickly and
easily be retrieved (see <code><a href="../articles/pkg-models.html">vignette("pkg-models")</a></code>). It can
also work with locally defined models (see
<code><a href="../articles/local-models.html">vignette("local-models")</a></code>).</p>
<p>Package model names can be listed with:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/list_models.html">list_models</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "five-year-age-groups" "old-and-young"</span></span></code></pre></div>
<p>To get a model’s simulator, we simply call:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">model.name</span> <span class="op">&lt;-</span> <span class="st">"old-and-young"</span></span>
<span><span class="va">model_simulator</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/make_simulator.html">make_simulator</a></span><span class="op">(</span></span>
<span>  model.name <span class="op">=</span> <span class="va">model.name</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning in checkMatrixPackageVersion(): Package version inconsistency detected.</span></span>
<span><span class="co">#&gt; TMB was built with Matrix version 1.6.1.1</span></span>
<span><span class="co">#&gt; Current Matrix version is 1.5.4.1</span></span>
<span><span class="co">#&gt; Please re-install 'TMB' from source using install.packages('TMB', type = 'source') or ask CRAN for a binary version of 'TMB' matching CRAN's 'Matrix' package</span></span></code></pre></div>
<p>By default, <code><a href="../reference/make_simulator.html">make_simulator()</a></code> will attach a set of
default values for variables in the model (components of flow rates,
initial states, etc.) to the model structure. It will also set a default
number of time steps. You can see all default values easily as
follows:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># load default values (initial state, params, etc.)</span></span>
<span><span class="va">default.values</span> <span class="op">=</span> <span class="fu"><a href="../reference/get_default_values.html">get_default_values</a></span><span class="op">(</span><span class="va">model.name</span><span class="op">)</span></span></code></pre></div>
<p>The definition of each default value is documented in
<code><a href="../articles/pkg-models.html">vignette("pkg-models")</a></code>.</p>
<p>Any of these values can be changed by passing the optional
<code>update.values</code> argument to <code><a href="../reference/make_simulator.html">make_simulator()</a></code>. We
recommend first loading the entire list of default values and extracting
the specific value (list element) that you want to update, editing the
numeric quantity as desired, and then passing the modified list element
to <code><a href="../reference/make_simulator.html">make_simulator()</a></code> via the <code>update.values</code>
argument, to ensure that format of value is preserved to remain
compatible with the model definition and <code>macpan2</code>:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># get default initial state</span></span>
<span><span class="va">default.state</span> <span class="op">=</span> <span class="va">default.values</span><span class="op">$</span><span class="va">state</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="st">"default state:"</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "default state:"</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">default.state</span><span class="op">)</span></span>
<span><span class="co">#&gt;      S_y      R_y      E_y      I_y      H_y      D_y      S_o      R_o </span></span>
<span><span class="co">#&gt; 31400000        0        1        1        0        0  6900000        0 </span></span>
<span><span class="co">#&gt;      E_o      I_o      H_o      D_o </span></span>
<span><span class="co">#&gt;        1        1        0        0</span></span>
<span></span>
<span><span class="co"># move some young susceptibles to the recovered class</span></span>
<span><span class="va">new.state</span> <span class="op">=</span> <span class="va">default.state</span> <span class="co"># copy over default value to preserve format</span></span>
<span><span class="va">new.state</span><span class="op">[</span><span class="st">"R_y"</span><span class="op">]</span> <span class="op">=</span> <span class="fl">1000</span> <span class="co"># modify specific elements</span></span>
<span><span class="va">new.state</span><span class="op">[</span><span class="st">"S_y"</span><span class="op">]</span> <span class="op">=</span> <span class="va">new.state</span><span class="op">[</span><span class="st">"S_y"</span><span class="op">]</span> <span class="op">-</span> <span class="va">new.state</span><span class="op">[</span><span class="st">"R_y"</span><span class="op">]</span> <span class="co"># modify specific elements</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="st">"new state:"</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "new state:"</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">new.state</span><span class="op">)</span></span>
<span><span class="co">#&gt;      S_y      R_y      E_y      I_y      H_y      D_y      S_o      R_o </span></span>
<span><span class="co">#&gt; 31399000     1000        1        1        0        0  6900000        0 </span></span>
<span><span class="co">#&gt;      E_o      I_o      H_o      D_o </span></span>
<span><span class="co">#&gt;        1        1        0        0</span></span>
<span></span>
<span><span class="co"># use updated state to make a new simulator </span></span>
<span><span class="va">new_model_simulator</span> <span class="op">=</span> <span class="fu"><a href="../reference/make_simulator.html">make_simulator</a></span><span class="op">(</span></span>
<span>  model.name <span class="op">=</span> <span class="va">model.name</span>,</span>
<span>  updated.values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>state <span class="op">=</span> <span class="va">new.state</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="simulate-a-model">Simulate a model<a class="anchor" aria-label="anchor" href="#simulate-a-model"></a>
</h2>
<p>To simulate a model, just use the <code><a href="../reference/simulate.html">simulate()</a></code>
function:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sim.output</span> <span class="op">=</span> <span class="fu"><a href="../reference/simulate.html">simulate</a></span><span class="op">(</span><span class="va">model_simulator</span><span class="op">)</span></span></code></pre></div>
<p>Since the model simulator already has all required values attached,
all required calculations can be performed to produce the simulation
results.</p>
<p>For all models, simulation outputs are stored in a data frame with
columns</p>
<pre><code><span><span class="va">time</span> <span class="op">|</span> <span class="va">state_name</span> <span class="op">|</span> <span class="va">value_type</span> <span class="op">|</span> <span class="va">value</span></span></code></pre>
<p>The output <code>value_types</code> are</p>
<ul>
<li>
<code>state</code>: the number of individuals in given state at a
given time,</li>
<li>
<code>total_inflow</code>: the total inflow into a given compartment
at a given time.</li>
</ul>
<p>For instance, here is the number of individuals in each state,
stratified by the two age groups <code>y</code> (young) and
<code>o</code> (old), at time 10:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="op">(</span><span class="va">sim.output</span></span>
<span> <span class="op">|&gt;</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">value_type</span> <span class="op">==</span> <span class="st">'state'</span>, <span class="va">time</span> <span class="op">==</span> <span class="fl">10</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt;    time state_name value_type        value</span></span>
<span><span class="co">#&gt; 1    10        S_y      state 3.139988e+07</span></span>
<span><span class="co">#&gt; 2    10        E_y      state 7.888172e+01</span></span>
<span><span class="co">#&gt; 3    10        I_y      state 2.644023e+01</span></span>
<span><span class="co">#&gt; 4    10        H_y      state 5.068467e+00</span></span>
<span><span class="co">#&gt; 5    10        R_y      state 7.329988e+00</span></span>
<span><span class="co">#&gt; 6    10        D_y      state 7.329988e-01</span></span>
<span><span class="co">#&gt; 7    10        S_o      state 6.899959e+06</span></span>
<span><span class="co">#&gt; 8    10        E_o      state 2.621033e+01</span></span>
<span><span class="co">#&gt; 9    10        I_o      state 9.945527e+00</span></span>
<span><span class="co">#&gt; 10   10        H_o      state 2.328352e+00</span></span>
<span><span class="co">#&gt; 11   10        R_o      state 3.674943e+00</span></span>
<span><span class="co">#&gt; 12   10        D_o      state 3.674943e-01</span></span></code></pre></div>
<p>The total inflow into <span class="math inline">\(I\)</span>
compartments can be used to extract disease incidence by age over
time:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="op">(</span><span class="va">sim.output</span></span>
<span> <span class="op">|&gt;</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span></span>
<span>   <span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_detect.html" class="external-link">str_detect</a></span><span class="op">(</span><span class="va">state_name</span>, <span class="st">"^I"</span><span class="op">)</span>,</span>
<span>   <span class="va">value_type</span> <span class="op">==</span> <span class="st">'total_inflow'</span></span>
<span> <span class="op">)</span></span>
<span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt;   time state_name   value_type     value</span></span>
<span><span class="co">#&gt; 1    1        I_y total_inflow 0.1000000</span></span>
<span><span class="co">#&gt; 2    1        I_o total_inflow 0.1000000</span></span>
<span><span class="co">#&gt; 3    2        I_y total_inflow 0.0990000</span></span>
<span><span class="co">#&gt; 4    2        I_o total_inflow 0.0990000</span></span>
<span><span class="co">#&gt; 5    3        I_y total_inflow 0.1455143</span></span>
<span><span class="co">#&gt; 6    3        I_o total_inflow 0.1195285</span></span></code></pre></div>
<p>We can plot the results using standard data manipulation and plotting
tools, like <code>dplyr</code> and <code>ggplot2</code>:</p>
<p><img src="EPACmodel_files/figure-html/sim-output-1-1.png" width="700"></p>
</div>
<div class="section level2">
<h2 id="scenarios">Scenarios<a class="anchor" aria-label="anchor" href="#scenarios"></a>
</h2>
<p>By default, <code><a href="../reference/make_simulator.html">make_simulator()</a></code> will initialize a base
model. Some model definitions include optional scenarios on top of the
base model, such as interventions modelled through time-varying model
parameters. For instance, one could simulate a stay-at-home order by
reducing the transmission rate on a given date by some amount.</p>
<p>One can specify the <code>scenario.name</code> argument in
<code><a href="../reference/make_simulator.html">make_simulator()</a></code> to attach the required model structure to
simulate a given scenario type. Scenario options and descriptions are
catalogued in <code><a href="../articles/pkg-models.html">vignette("pkg-models")</a></code>.</p>
<p>Here we demonstrate the <code>old-and-young</code> model with the
<code>transmission-intervention</code> scenario. By default, this
scenario reduces the transmission rate in each age group to 50% then 10%
of its original value on days 30 and 40, respectively:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">values</span> <span class="op">=</span> <span class="fu"><a href="../reference/get_default_values.html">get_default_values</a></span><span class="op">(</span><span class="st">"old-and-young"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">values</span><span class="op">[</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"intervention.day"</span>, <span class="st">"trans.factor.young"</span>, <span class="st">"trans.factor.old"</span><span class="op">)</span></span>
<span><span class="op">]</span></span>
<span><span class="co">#&gt; $intervention.day</span></span>
<span><span class="co">#&gt; [1] 40 50</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $trans.factor.young</span></span>
<span><span class="co">#&gt; [1] 0.5 0.1</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $trans.factor.old</span></span>
<span><span class="co">#&gt; [1] 0.5 0.1</span></span></code></pre></div>
<p>We specify that we want to use the <code>change-transmission</code>
scenario in the call to <code><a href="../reference/make_simulator.html">make_simulator()</a></code>:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">model_simulator</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/make_simulator.html">make_simulator</a></span><span class="op">(</span></span>
<span>  model.name <span class="op">=</span> <span class="st">"old-and-young"</span>,</span>
<span>  scenario.name <span class="op">=</span> <span class="st">"change-transmission"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">sim.output</span> <span class="op">=</span> <span class="fu"><a href="../reference/simulate.html">simulate</a></span><span class="op">(</span><span class="va">model_simulator</span><span class="op">)</span></span></code></pre></div>
<p><img src="EPACmodel_files/figure-html/sim-output-2-1.png" width="700"></p>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by <a href="https://github.com/papsti" class="external-link">Irena Papst</a>, <a href="https://github.com/wzmli" class="external-link">Michael WZ Li</a>.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
